<?php

$data1 = array(
			array(
				"id" => "0",
				"title" => "Земельный участок (покупка, аренда)",
				"all" => 76000000,
				"months" => array(76000000),
			),

			array(
				"id" => "1",
				"title" => "Работы подготовительного периода",
				"all" => 25500000,
				"months" => array(500000,3500000,5000000,500000,900000,5100000,0,3500000,0)
			),

			array(
				"id" => "1.1",
				"title" => "Проектирование, получение технических условий,земля",
				"all" => 12000000,
				"months" => array(500000,5000000,400000,5100000)			
			),

			array(
				"id" => "1.2",
				"title" => "ВЗиС",
				"all" => 11000000,
				"months" => array(3500000,3500000)
			),
				
			array(
				"id" => "1.3.",
				"title" => "Башенный кран",
				"all" => 2500000,
				"months" => array(500000,500000)	
			),
				
			array(
				"id" => "2",
				"title" => "Строительные работы ниже отм. 0.000",
				"all" => 671000000,
				"months" => array()
			),

			array(
				"id" => "2.1",
				"title" => "Земляные работы",
				"all" => 6000000,
				"months" => array(500000,	3000000,		2500000)	
			),
							
			array(
				"id" => "2.2",
				"title" => "Свайные работы",
				"all" => 98000000,
				"months" => array(	15000000,	15000000,	15000000,	15000000,	20000000,			15000000)	
			),

			array(
				"id" => "2.3.",
				"title" => "Фундамент",
				"all" => 50000000,
				"months" => array(		7500000,		7500000,		15000000,			17000000)
			),

			array(
				"id" => "2.4",
				"title" => "Гидроизоляция",
				"all" => 6000000,
				"months" => array(			3000000,		3000000)		
			),
					
			array(
				"id" => "2.5",
				"title" => "Монолитные конструкции ниже отм.ниже 0.000",
				"all" => 250000000,
				"months" => array(	25000000,	30000000,		45000000,	45000000,	15000000,	27900000)	
			),
				
			array(
				"id" => "2.6",
				"title" => "Стены и перегородки ниже отм.0.000",
				"all" => 150000000,
				"months" => array(	20000000,		20000000,					30000000	)
			),

			array(
				"id" => "2.7",
				"title" => "Внутренние отделочные работы ниже 0.000",
				"all" => 111000000,
				"months" => array(	)
			),
				
			array(
				"id" => "3",
				"title" => "Основные строительные работы выше отм 0.000",
				"all" => 901000000,
				"months" => array(	35000000,	27500000,	57500000,	42000000,	22500000,	50950000,	20000000,	27000000,	25000000)
			),

			array(
				"id" => "3.1",
				"title" => "Устройство каркаса здания  выше 0.000",
				"all" => 300000000,
				"months" => array(	25000000,	25000000,	25000000,	15000000,	10000000,	35000000,	15000)
			),
			 
			array(
				"id" => "3.2",
				"title" => "Устройство ограждающих конструкций наружных стен выше отм. 0.000",
				"all" => 100000000,
				"months" => array(		1000000,	30000000,	20000000,	5000000,	15000000,		27000000)
			),
				
			array(
				"id" => "3.3",
				"title" => "Кладка внутренних стен и перегородок выше 0.000",
				"all" => 150000000,
				"months" => array(			10000000,				5000000,		5000000,		25000000)
			),

			array(
				"id" => "3.4",
				"title" => "Установка окон и балконных дверей",
				"all" => 150000000,
				"months" => array(				1500000	)	
			),
								
			array(
				"id" => "3.5",
				"title" => "Устройство витражей",
				"all" => 0		
			),
										
			array(
				"id" => "3.6",
				"title" => "Внутренние отделочные работы выше 0.000",
				"all" => 112000000,
				"months" => array(					2500000,		2500000	)
			),
						
			array(
				"id" => "3.7",
				"title" => "Монтаж квартирных дверей и дверей в МОП",
				"all" => 25000000,
				"months" => array(						7000000 )				
			),
				
			array(
				"id" => "3.8",
				"title" => "Устройство отделки фасада и деформационных швов",
				"all" => 15000000,
				"months" => array(								500000		)	
			),

			array(
				"id" => "3.9",
				"title" => "Устройство кровли",
				"all" => 40000000,
				"months" => array(								450000	)	
			),
				
			array(
				"id" => "3.10",
				"title" => "Устройство входных групп",
				"all" => 6000000,
				"months" => array(			)					
			),
						
			array(
				"id" => "3.11",
				"title" => "Металлические перильные ограждения лестниц (внутренние)",
				"all" => 3000000,
				"months" => array(	)				
			),
									
			array(
				"id" => "4",
				"title" => "Специализированные работы",
				"all" => 398300000,
				"months" => array(			0,	5000000,	3500000,	3500000,	20000000,	75000000,	25000000,	7200000,	0)
			),

			array(
				"id" => "4.1",
				"title" => "Устройство лифтов (поставка+монтаж+пуск)",
				"all" => 64500000,
				"months" => array(								55000000	)
			),
					
			array(
				"id" => "4.2",
				"title" => "Устройство подъемников для инвалидов",
				"all" => 15000000,
				"months" => array(				5000000	,				5000000)	
			),
				
			array(
				"id" => "4.3",
				"title" => "Отопление",
				"all" => 9000000,
				"months" => array(					3500000,	3500000)	
			),
							
			array(
				"id" => "4.4",
				"title" => "Эл.монтажные работы",
				"all" => 75000000,
				"months" => array(							20000000,	20000000,	20000000)	
			),
				
			array(
				"id" => "4.5",
				"title" => "Вентиляция",
				"all" => 45000000,
				"months" => array(										1000000	)
			),

			array(
				"id" => "4.6",
				"title" => "Водопровод",
				"all" => 56000000,
				"months" => array(										5000000)	
			),

			array(
				"id" => "4.7",
				"title" => "Канализация",
				"all" => 15000000,
				"months" => array(										1200000	)
			),

			array(
				"id" => "4.8",
				"title" => "Сети связи",
				"all" => 1500000,
				"months" => array(			)								
			),

			array(
				"id" => "4.9",
				"title" => "Система АПС,СОУЭ.",
				"all" => 95000000,
				"months" => array(		)								
			),
				
			array(
				"id" => "4.10",
				"title" => "Монтаж ВНС",
				"all" => 6700000,
				"months" => array(		)				
			),
								
			array(
				"id" => "4.11",
				"title" => "Монтаж ИТП",
				"all" => 15600000,
				"months" => array(		)									
			),

			array(
				"id" => "5",
				"title" => "Автопарковка",
				"all" => 189650000,
				"months" => array(			17500000,	16500000,	37000000,	15000000,	3000000,	47500000,	4500000,	0,	0)
			),

			array(
				"id" => "5.1",
				"title" => "Земляные работы автопарковка",
				"all" => 2500000,
				
			),
										
			array(
				"id" => "5.2",
				"title" => "Устройство монолитнвых ж/б конструкций фундаментной плиты",
				"all" => 45000000,
					
			),
							
			array(
				"id" => "5.3",
				"title" => "Устройство монолитных ж/б конструкций стен, колон, перекрытий",
				"all" => 125000000,
				
			),
					
			array(
				"id" => "5.4",
				"title" => "Кладка стен и перегородок автопарковки",
				"all" => 6000000,
				
			),
					
			array(
				"id" => "5.5",
				"title" => "Заполнение проемов, установка противопожарных ворот",
				"all" => 1000000,
												
			),

			array(
				"id" => "5.6",
				"title" => "Эл.монтажные работы автопарковки",
				"all" => 5000000,
				
			),

			array(
				"id" => "5.7",
				"title" => "Вентиляция автопарковки",
				"all" => 600000,
												
			),

			array(
				"id" => "5.8",
				"title" => "АУПТ Водопровод автопарковки",
				"all" => 2500000,
												
			),
				
			array(
				"id" => "5.9",
				"title" => "Система АПС,СОУЭ автопарковки",
				"all" => 1500000,
				
			),
				
			array(
				"id" => "5.10",
				"title" => "Кладочные конструкции автопарковки (входные группы) прочие",
				"all" => 550000	,
											
			),
				
			array(
				"id" => "5.11",
				"title" => "Отделочные работы автопарковки",
				"all" => 0									
			),

			array(
				"id" => "5.12",
				"title" => "Устройство кровли автопарковки",
				"all" => 0									
			),

			array(
				"id" => "6",
				"title" => "Внутриплощадочные сети/благоустройство",
				"all" => 145305000,
				
			),

			array(
				"id" => "6.1",
				"title" => "Внутриплощадочные сети водопровода В1",
				"all" => 5150000,
							
			),
				
			array(
				"id" => "6.2",
				"title" => "Внутриплощадочные сети канализации бытовой К1",
				"all" => 20500000,
								
			),

			array(
				"id" => "6.3",
				"title" => "Внутриплощадочные сети канализации ливневой К2",
				"all" => 24900000,
							
			),

			array(
				"id" => "6.4",
				"title" => "Внутриплощадочные тепловые сети ТС",
				"all" => 9055000,
						
			),
				
			array(
				"id" => "6.5",
				"title" => "Внутриплощадочные сети электроснабжения 0,4кВ",
				"all" => 15600000									
			),

			array(
				"id" => "6.6",
				"title" => "Наружнее освещение",
				"all" => 3800000									
			),

			array(
				"id" => "6.7",
				"title" => "Благоустройство",
				"all" => 66300000									
			),

			array(
				"id" => "7",
				"title" => "Внеплощадочные сети (инженерная подготовка территории)",
				"all" => 140462000,
				
			),

			array(
				"id" => "7.1",
				"title" => "Магистральные сети водопровода",
				"all" => 98000000,
				"months" => array(										95000000)	
			),

			array(
				"id" => "7.2",
				"title" => "Магистральные сети канализации бытовой КНС+К1",
				"all" => 3000000,
				
			),

			array(
				"id" => "7.3",
				"title" => "Магистральные сети канализации ливневой ЛНС+К2",
				"all" => 0									
			),

			array(
				"id" => "7.4",
				"title" => "Магистральные  тепловые сети",
				"all" => 25362000,
	
			),

			array(
				"id" => "7.5",
				"title" => "Внеплощадочные сети электроснабжения",
				"all" => 2600000									
			),

			array(
				"id" => "7.6",
				"title" => "2БКТП",
				"all" => 2500000,		
			),

			array(
				"id" => "7.7",
				"title" => "Дороги, проезды",
				"all" => 9000000									
			),

			array(
				"id" => "8",
				"title" => "Чистовая отделка квартир",
				"all" => 58000000									
			),

			array(
				"id" => "9",
				"title" => "Непредвиденные расходы Генподрядчика",
				"all" => 135000000,
			),

			array(
				"id" => "10",
				"title" => "Общехозяйственные расходы	",
				"all" => 2991667,
			),

			array(
				"id" => "10.1.",
				"title" => "Оргтехника и ПО",
				"all" => 3000000,
			),

			array(
				"id" => "10.2.",
				"title" => "Офисные расходы",
				"all" => 25000000,
			),

			array(
				"id" => "10.3.",
				"title" => "Подарки и благотворительность",
				"all" => 5000000,
			),
				
			array(
				"id" => "10.4.",
				"title" => "Представительские",
				"all" => 4500000,					
			),
				
			array(
				"id" => "10.5.",
				"title" => "Эксплуатация",
				"all" => 4700000,	
			),

			array(
				"id" => "10.6.",
				"title" => "Юридические расходы",
				"all" => 5000000,		
			),
				
			array(
				"id" => "10.7.",
				"title" => "Выплаты по финансовой деятельности",
				"all" => 161000000
			),				
			array(
				"id" => "10.8.",
				"title" => "Зарплата и отпускные",
				"all" => 45000000,
			),

			array(
				"id" => "10.9.",
				"title" => "Зарплата и отпускные (ОП)",
				"all" => 15000000,					
			),

			array(
				"id" => "10.10.",
				"title" => "Выплаты риэлторам и прочим посредникам при продаже",
				"all" => 62000000,
			),

			array(
				"id" => "10.11.",
				"title" => "Маркетинг",
				"all" => 200000,	
			),

			array(
				"id" => "10.12.",
				"title" => "Налоги и сборы",
				"all" => 45700000,		
			),
				
			array(
				"id" => "10.13.",
				"title" => "Клининг",
				"all" => 3000000					
			),
							
			array(
				"id" => "10.14.",
				"title" => "Инвестиционная деятельность",
				"all" => 0									
			),

			array(
				"id" => "11",
				"title" => "Непредвиденные расходы Заказчика",
				"all" => 0								
			),
);

$data = array(
	array(
		"category" => "Работы подготовительного периода", 
		"value" => 75, 
		"full" => 100 
	), 
	array(
		"category" => "Строительные работы ниже отм. 0.000", 
		"value" => 61, 
		"full" => 100 
	), 
	array(
		"category" => "Основные строительные работы выше отм 0.000", 
		"value" => 34, 
		"full" => 100 
	), 
	array(
		"category" => "Специализированные работы", 
		"value" => 35, 
		"full" => 100 
	), 
	array(
		"category" => "Автопарковка", 
		"value" => 74, 
		"full" => 100 
	), 
	array(
		"category" => "Внутриплощадочные сети/благоустройство", 
		"value" => 19, 
		"full" => 100 
	), 
	array(
		"category" => "Внеплощадочные сети (инженерная подготовка территории)", 
		"value" => 86, 
		"full" => 100 
	), 
	array(
		"category" => "Чистовая отделка квартир", 
		"value" => 0, 
		"full" => 100 
	), 
	array(
		"category" => "Непредвиденные расходы Генподрядчика", 
		"value" => 55, 
		"full" => 100 
	)
);

if(0 == $_REQUEST["id"]) {
	$data = array();
	
	foreach($data1 as $item) {
		$_tmp = explode('.', $item["id"]);
		
		if(0 == (int)$_tmp[1]) {
			$data[] = array(
				"category" => $item["title"], 
				"value" => $item["all"], 
				"full" => 100
			);
			
			$sum =  $sum + $item["all"];
		}
	}
	
	$data1 = array();
	
	foreach($data as $indx => $item) {
		$data[$indx]["value"] = ($data[$indx]["value"]/$sum)*100;
		$data1[] = array(
			"country" => $indx,
			"visits" => $data[$indx]["value"],
		);
	}

	
}
else {
	$data = array();
	
	foreach($data1 as $item) {
		$_tmp = explode('.', $item["id"]);
		
		if($_REQUEST["id"] == (int)$_tmp[1]) {
			$data[] = array(
				"category" => $item["title"], 
				"value" => $item["all"], 
				"full" => 100
			);
			
			$sum =  $sum + $item["all"];
		}
	}
	
	$data1 = array();
	
	foreach($data as $indx => $item) {
		$data[$indx]["value"] = ($data[$indx]["value"]/$sum)*100;
		$data1[] = array(
			"country" => $indx,
			"visits" => $data[$indx]["value"],
		);
	}
}


?>
<div class="row">
	<div class="col-md-6 col-sm-12" >
		<div id="chartdiv" style="min-height: 500px"></div>
	</div>
	<div class="col-md-6 col-sm-12" style="">
		<div id="chartdiv1" style="min-height: 500px"></div>
	</div>
	
	<div class="col-md-12 col-sm-12">
		<div class="x_panel">
		  <div class="x_title">
			<h2>Данные <small></small></h2>
			<!--ul class="nav navbar-right panel_toolbox">
			  <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
			  </li>
			  <li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
				<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
					<a class="dropdown-item" href="#">Settings 1</a>
					<a class="dropdown-item" href="#">Settings 2</a>
				  </div>
			  </li>
			  <li><a class="close-link"><i class="fa fa-close"></i></a>
			  </li>
			</ul-->
			<div class="clearfix"></div>
		  </div>
		  <div class="x_content">

			<table class="table">
			  <thead>
				<tr>
				  <th>id</th>
				  <th>Наименование</th>
				  <th>Значение</th>
				  <th></th>
				</tr>
			  </thead>
			  <tbody>
			  <?php foreach($data as $item): ?>
				<tr>
				  <th scope="row"></th>
				  <td><?=$item["category"]?></td>
				  <td><?=$item["value"]?></td>
				  <td></td>
				</tr>
			<? endforeach ?>
			  </tbody>
			</table>

		  </div>
		</div>
	  </div>
	
</div>

<script>
	am4core.ready(function() {

	// Themes begin
	am4core.useTheme(am4themes_dataviz);
	am4core.useTheme(am4themes_animated);
	// Themes end



	// Create chart instance
	var chart = am4core.create("chartdiv", am4charts.RadarChart);

	// Add data
	chart.data = <?=json_encode($data)?>;
	var tmp = <?=json_encode($data)?>;
	// console.log(chart.data[0].category);
	// Make chart not full circle
	chart.startAngle = -90;
	chart.endAngle = 180;
	chart.innerRadius = am4core.percent(20);

	// Set number format
	chart.numberFormatter.numberFormat = "#.#'%'";

	// Create axes
	var categoryAxis = chart.yAxes.push(new am4charts.CategoryAxis());
	categoryAxis.dataFields.category = "category";
	categoryAxis.renderer.grid.template.location = 0;
	categoryAxis.renderer.grid.template.strokeOpacity = 0;
	categoryAxis.renderer.labels.template.horizontalCenter = "right";
	categoryAxis.renderer.labels.template.fontWeight = 500;
	categoryAxis.renderer.labels.template.adapter.add("fill", function(fill, target) {
	  return (target.dataItem.index >= 0) ? chart.colors.getIndex(target.dataItem.index) : fill;
	});
	categoryAxis.renderer.minGridDistance = 10;

	var valueAxis = chart.xAxes.push(new am4charts.ValueAxis());
	valueAxis.renderer.grid.template.strokeOpacity = 0;
	valueAxis.min = 0;
	valueAxis.max = 100;
	valueAxis.strictMinMax = true;

	// Create series
	var series1 = chart.series.push(new am4charts.RadarColumnSeries());
	series1.dataFields.valueX = "full";
	series1.dataFields.categoryY = "category";
	series1.clustered = false;
	series1.columns.template.fill = new am4core.InterfaceColorSet().getFor("alternativeBackground");
	series1.columns.template.fillOpacity = 0.08;
	series1.columns.template.cornerRadiusTopLeft = 20;
	series1.columns.template.strokeWidth = 0;
	series1.columns.template.radarColumn.cornerRadius = 20;


	var series2 = chart.series.push(new am4charts.RadarColumnSeries());
	series2.dataFields.valueX = "value";
	series2.dataFields.categoryY = "category";
	series2.clustered = false;
	series2.columns.template.strokeWidth = 0;
	series2.columns.template.tooltipText = "{category}: [bold]{value}[/]";
	series2.columns.template.radarColumn.cornerRadius = 20;

	series2.columns.template.adapter.add("fill", function(fill, target) {
		// console.log(chart.data[target.dataItem.index]); 
	  return chart.colors.getIndex(target.dataItem.index);
	});

	series2.columns.template.events.on("hit", function(ev) {
	//   alert("Clicked on " + ev.target.dataItem.index );
		console.log(tmp[ev.target.dataItem.index].category);
	//   window.location.href = "/monitoring?id=" + ev.target.dataItem.index;
	});


	// Add cursor
	chart.cursor = new am4charts.RadarCursor();
	
	
	
	
	
	
	var chart = am4core.create("chartdiv1", am4charts.XYChart);

/* chart.data = <?=json_encode($data1)?>;

chart.padding(40, 40, 40, 40);

var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
categoryAxis.renderer.grid.template.location = 0;
categoryAxis.dataFields.category = "country";
categoryAxis.renderer.minGridDistance = 60;
categoryAxis.renderer.inversed = true;
categoryAxis.renderer.grid.template.disabled = true;

var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
valueAxis.min = 0;
valueAxis.extraMax = 0.1;
//valueAxis.rangeChangeEasing = am4core.ease.linear;
//valueAxis.rangeChangeDuration = 1500;

var series = chart.series.push(new am4charts.ColumnSeries());
series.dataFields.categoryX = "country";
series.dataFields.valueY = "visits";
series.tooltipText = "{valueY.value}"
series.columns.template.strokeOpacity = 0;
series.columns.template.column.cornerRadiusTopRight = 10;
series.columns.template.column.cornerRadiusTopLeft = 10;
//series.interpolationDuration = 1500;
//series.interpolationEasing = am4core.ease.linear;
var labelBullet = series.bullets.push(new am4charts.LabelBullet());
labelBullet.label.verticalCenter = "bottom";
labelBullet.label.dy = -10;
labelBullet.label.text = "{values.valueY.workingValue.formatNumber('#.')}";

chart.zoomOutButton.disabled = true;

// as by default columns of the same series are of the same color, we add adapter which takes colors from chart.colors color set
series.columns.template.adapter.add("fill", function (fill, target) {
 return chart.colors.getIndex(target.dataItem.index);
});



categoryAxis.sortBySeries = series;
	 */
	
	
	
	

	}); // end am4core.ready()
</script>


